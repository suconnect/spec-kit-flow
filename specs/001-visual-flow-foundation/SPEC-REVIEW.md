# Specification Review Checklist

**文档**: `specs/001-visual-flow-foundation/spec.md`  
**阶段**: STEP 2 - 等待用户确认  
**目的**: 系统性审查 spec.md，确认所有关键需求后才进入 plan.md 阶段

---

## 📋 核心定位确认

### ✅ 1. 内容结构可视化（而非文件结构）

**确认内容**：
- [ ] Markdown 文档的**标题层级**（#、##、###）转换为思维导图节点
- [ ] 一个标题 = 一个节点（而非一个文件 = 一个节点）
- [ ] 从左到右的思维导图布局

**示例**：
```
spec.md 文件内容:
# 功能规格: Spec-Kit Flow 核心可视化框架
## 用户场景与测试
### 用户故事 1 - 自由布局可视化文档结构（优先级：P1）

解析为节点树:
[功能规格] ──→ [用户场景与测试] ──→ [用户故事 1 - P1]
   (L1)              (L2)                  (L3)
```

**确认**：✅ / ❌ / 需调整 ____✅_______

---

### ✅ 2. FlowGram 卡片节点展示

**确认内容**：
- [ ] 节点以**卡片形式**展示（参考 flowgram.ai）
- [ ] 卡片包含：图标、标题、优先级标记、内容预览、元数据
- [ ] 卡片尺寸：标准 200×80px，可展开

**卡片结构示例**：
```
┌────────────────────────────────────┐
│ 📖 用户故事 1                  [P1]│ ← 标题栏
├────────────────────────────────────┤
│ 自由布局可视化文档结构              │ ← 主标题
│                                    │
│ 作为 spec-kit 用户，我希望在可视化 │ ← 内容预览
│ 流程图中看到项目的所有文档...      │   (前 2-3 行)
│                                    │
├────────────────────────────────────┤
│ 📊 草稿 | 230 字 | 10分钟前    [⚙️]│ ← 底栏：元数据 + 操作
└────────────────────────────────────┘
```

**确认**：✅ / ❌ / 需调整 ___✅________

---

### ✅ 3. 编辑交互体验

**确认内容**：

#### 主要编辑方式：点击展开右侧面板
- [ ] **点击节点卡片** → 右侧配置面板自动滑出展开
- [ ] 面板包含：TipTap 富文本编辑器 + 格式化工具栏
- [ ] 工具栏按钮：[B] [I] [标题▼] [•] [1.] [[ ]] [<>] 等
- [ ] 所有内容编辑在右侧面板完成（所见即所得）

#### 标题快捷编辑（可选便捷功能）
- [ ] **鼠标悬停**在卡片标题文字 → 出现编辑图标（✏️）
- [ ] **单击标题** → 进入 inline 编辑模式（直接修改标题）
- [ ] 按 Enter 保存，Esc 取消
- [ ] 适用场景：快速修改标题，无需打开完整编辑器

**交互流程**：
```
用户点击卡片
    ↓
右侧面板自动展开
    ↓
显示 TipTap 富文本编辑器（完整内容）
    ↓
用户使用工具栏格式化内容（加粗、列表、代码等）
    ↓
自动保存到 Markdown 文件（1秒防抖）

---

快捷方式（仅修改标题时）：
悬停标题 → 出现 ✏️ → 单击 → inline 编辑 → Enter 保存
```

**确认**：✅ / ❌ / 需调整 ___✅________

---

### ✅ 4. 富文本编辑器（TipTap）

**确认内容**：
- [ ] 使用 TipTap 富文本编辑器（而非 CodeMirror Markdown 编辑器）
- [ ] 所见即所得（WYSIWYG）：用户看到的就是最终效果
- [ ] Markdown ↔ 富文本双向转换（自动、透明）
- [ ] 面向非技术人员：PM、设计师、业务人员都能使用
- [ ] 无需了解 Markdown 语法

**用户操作示例**：
| 用户想要 | 操作 | Markdown 结果 |
|---------|------|--------------|
| 加粗文本 | 选中文本 → 点击工具栏 [B] 按钮 | `**加粗文本**` |
| 创建列表 | 点击工具栏 [•] 按钮 | `- 列表项` |
| 插入标题 | 点击工具栏 [标题▼] → 选择 H2 | `## 标题` |

**确认**：✅ / ❌ / 需调整 ____✅_______

---

### ✅ 5. 用户故事优先级

**当前分配**（来自 spec.md）：

| 用户故事 | 优先级 | 理由 |
|---------|-------|------|
| 1. 自由布局可视化文档结构 | **P1** | 系统基础，没有可视化就无法进行后续操作 |
| 2. Markdown 内容编辑与预览 | **P1** | 编辑功能是核心价值，构成 MVP |
| 3. 文档节点的增删管理 | **P2** | 提升便利性，但可先用外部方式创建文件 |
| 4. AI 执行状态实时同步 | **P2** | 重要但可以后实现，用户可先手动刷新 |
| 5. 内容更新后触发 AI 校验 | **P3** | 增强功能，可通过命令手动校验 |
| 6. CLI 工具集成框架 | **P3** | 便利性功能，可先在终端执行命令 |

**MVP 范围**：P1（故事 1 + 2）= 可视化 + 编辑

**确认**：✅ / ❌ / 需调整优先级 ____✅_______

---

## 📊 技术约束确认

### ✅ 6. 性能要求

- [ ] 解析 1000 行 spec.md < 100ms
- [ ] 渲染 100+ 节点 < 2s
- [ ] 拖拽帧率 60fps
- [ ] 文件同步延迟 < 500ms

**确认**：✅ / ❌ / 需调整目标 __✅_________

---

### ✅ 7. 技术实现策略

**确认内容**：

#### 改造基础：flowgram.ai demo-free-layout ⭐
- [ ] **项目基础**：Fork 或直接基于 flowgram.ai demo-free-layout 改造
- [ ] **复用模块**：
  - ✅ 节点渲染引擎（卡片组件）
  - ✅ 配置面板系统（PropertiesPanel）
  - ✅ 拖拽和布局算法
  - ✅ 数据保存和加载逻辑
  - ✅ 画布交互（缩放、平移）
- [ ] **尊崇规范**：遵循 flowgram.ai 的架构、组件结构、命名约定
- [ ] **禁止重写**：不要重新实现已有功能，只扩展

#### 新增扩展（在 flowgram.ai 基础上）
- [ ] **Markdown 适配层**：
  - Markdown 文件 ↔ flowgram.ai 节点数据格式转换
  - 使用 unified/remark 解析和构建
- [ ] **spec-kit 识别**：
  - 识别用户故事、优先级、验收场景
  - 自动添加元数据和标记
- [ ] **TipTap 集成**：
  - 集成到 flowgram.ai 的配置面板
  - 替换或扩展原有编辑器
- [ ] **Tauri 桌面化**：
  - 文件系统访问
  - 文件监听

**确认**：✅ / ❌ / 需调整策略 ___✅_______

---

### ✅ 8. 范围边界

**范围内（v1）**：
- [ ] 基于 flowgram.ai 改造（复用核心功能）
- [ ] Markdown 结构解析和可视化
- [ ] spec-kit 特化（识别用户故事、优先级、验收场景）
- [ ] 富文本编辑器集成（TipTap）
- [ ] 文件系统集成和监听

**范围外（v1）**：
- [ ] 多用户协作
- [ ] Git 集成
- [ ] 云存储/同步
- [ ] 移动端支持
- [ ] Mermaid/PlantUML 图表渲染
- [ ] 重新实现 flowgram.ai 已有的功能（禁止）

**确认**：✅ / ❌ / 需调整范围 _____✅______

---

## 🎯 最终确认

### ✅ 确认状态（8/8）

1. ✅ 核心定位 - 内容结构可视化
2. ✅ FlowGram 卡片节点展示
3. ✅ 编辑交互体验 - 点击展开右侧面板
4. ✅ 富文本编辑器 - TipTap
5. ✅ 用户故事优先级
6. ✅ 性能要求
7. ✅ 技术实现策略 - 基于 flowgram.ai 改造
8. ✅ 范围边界

**所有关键点已确认！可以进入 STEP 3**

---

## 📝 spec.md 更新摘要

已根据确认内容更新 `spec.md` v2.0：

### 核心变更
1. **概述**: 强调内容结构可视化 + 基于 flowgram.ai 改造
2. **用户故事 1**: 改为"Markdown 内容结构可视化"（解析标题层级）
3. **用户故事 2**: 改为"富文本编辑与自动保存"（TipTap，面向非技术人员）
4. **功能性需求**: 重组为：
   - 基于 flowgram.ai 改造（FR-001, FR-002）
   - Markdown 内容结构解析（FR-003 ~ FR-005）
   - 卡片节点展示（FR-006 ~ FR-011）
   - 富文本编辑（FR-012 ~ FR-019）
   - 文档节点管理（FR-020 ~ FR-023）
   - 文件系统同步（FR-024 ~ FR-027）
   - AI 集成（FR-028 ~ FR-029）
   - CLI 工具集成（FR-030 ~ FR-034）
5. **关键实体**: 更新为卡片节点、Markdown 适配器、配置面板等
6. **假设与依赖**: 依赖 flowgram.ai 项目、unified、TipTap、Tauri
7. **范围外**: 新增 OS-008（不重新实现 flowgram.ai 已有功能）

---

## 🚀 下一步：STEP 3

### 将要创建的 plan.md 包含：

1. **flowgram.ai 项目结构分析**
   - 节点数据格式（Node interface）
   - 配置面板系统（PropertiesPanel）
   - 保存和加载逻辑
   - 布局引擎和拖拽系统
   
2. **Markdown 适配器设计**
   - Markdown AST → flowgram.ai 节点格式
   - flowgram.ai 节点 → Markdown AST
   - 双向转换保证无损
   
3. **TipTap 集成方案**
   - 集成到 flowgram.ai 配置面板
   - 工具栏设计
   - Markdown ↔ 富文本转换
   
4. **实施阶段划分**
   - Phase 1: Fork flowgram.ai 项目
   - Phase 2: Markdown 适配层
   - Phase 3: spec-kit 识别器
   - Phase 4: TipTap 集成
   - Phase 5: Tauri 桌面化
   - Phase 6-8: 测试、优化、文档
   
**预计时间**: 10-15 工作日（因复用了 flowgram.ai 核心代码）

---

## ✍️ 确认结果

✅ **全部 8 点已确认**

---

**状态**: ✅ 已完成确认，spec.md v2.0 已生成  
**生成时间**: 2025-10-31  
**SDD 阶段**: STEP 2 → 准备进入 STEP 3

---

### 🎯 请用户最终确认

请查看更新后的 `spec.md` v2.0，确认是否准确反映了所有已确认的需求。

**确认无误后，回复**：
- ✅ 确认，可以进入 STEP 3（编写 plan.md）

**如有需要调整，回复**：
- ❌ 第 X 点需要调整：___________


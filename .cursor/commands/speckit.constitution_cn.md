---
description: 从交互式或提供的原则输入创建或更新项目章程，确保所有依赖模板保持同步
---

## 用户输入

```text
$ARGUMENTS
```

在继续之前，你**必须**考虑用户输入（如果不为空）。

## 概述

你正在更新位于 `.specify/memory/constitution.md` 的项目章程。该文件是一个包含方括号占位符标记（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）的模板。你的任务是：（a）收集/派生具体值，（b）精确填充模板，以及（c）将任何修订传播到依赖的产物中。

遵循以下执行流程：

1. 加载 `.specify/memory/constitution.md` 中的现有章程模板。
   - 识别所有形式为 `[ALL_CAPS_IDENTIFIER]` 的占位符标记。
   **重要**：用户可能需要的原则数量比模板中使用的更多或更少。如果指定了数量，请尊重该数量 - 遵循一般模板。你将相应地更新文档。

2. 为占位符收集/派生值：
   - 如果用户输入（对话）提供了值，则使用它。
   - 否则从现有仓库上下文（README、文档、先前的章程版本如果嵌入）推断。
   - 对于治理日期：`RATIFICATION_DATE` 是原始采纳日期（如果未知，询问或标记 TODO），`LAST_AMENDED_DATE` 如果进行了更改则是今天，否则保留先前的日期。
   - `CONSTITUTION_VERSION` 必须根据语义版本规则递增：
     - MAJOR（主版本）：向后不兼容的治理/原则移除或重新定义。
     - MINOR（次版本）：新增原则/章节或实质性扩展指导。
     - PATCH（补丁版本）：澄清、措辞、拼写修复、非语义改进。
   - 如果版本升级类型不明确，在最终确定之前提出推理。

3. 起草更新后的章程内容：
   - 用具体文本替换每个占位符（不留下任何带括号的标记，除非项目有意保留的模板槽位尚未定义——对任何保留的明确说明理由）。
   - 保留标题层次结构，除非替换后的注释仍能增加澄清性指导，否则可以删除。
   - 确保每个原则部分：简洁的名称行、段落（或项目符号列表）捕获不可协商的规则、如果不明显则提供明确的理由。
   - 确保治理部分列出修订程序、版本控制策略和合规性审查期望。

4. 一致性传播检查清单（将先前的检查清单转换为主动验证）：
   - 读取 `.specify/templates/plan-template.md` 并确保任何"章程检查"或规则与更新的原则保持一致。
   - 读取 `.specify/templates/spec-template.md` 以进行范围/需求对齐——如果章程添加/删除了强制性部分或约束，则更新。
   - 读取 `.specify/templates/tasks-template.md` 并确保任务分类反映新的或已删除的原则驱动的任务类型（例如，可观察性、版本控制、测试规程）。
   - 读取 `.specify/templates/commands/*.md` 中的每个命令文件（包括此文件），以验证当需要通用指导时，没有过时的引用（仅特定于代理的名称如 CLAUDE）。
   - 读取任何运行时指导文档（例如，`README.md`、`docs/quickstart.md` 或特定于代理的指导文件（如果存在））。更新对已更改原则的引用。

5. 生成同步影响报告（更新后在章程文件顶部添加 HTML 注释）：
   - 版本变更：旧版本 → 新版本
   - 修改的原则列表（如果重命名则为：旧标题 → 新标题）
   - 添加的部分
   - 删除的部分
   - 需要更新的模板（✅ 已更新 / ⚠ 待处理）及文件路径
   - 如果有意延迟任何占位符，则列出后续待办事项。

6. 最终输出前的验证：
   - 没有剩余的未解释的括号标记。
   - 版本行与报告匹配。
   - 日期采用 ISO 格式 YYYY-MM-DD。
   - 原则是声明性的、可测试的，并且没有模糊语言（"should" → 在适当的地方用 MUST/SHOULD 理由替换）。

7. 将完成的章程写回 `.specify/memory/constitution.md`（覆盖）。

8. 向用户输出最终摘要：
   - 新版本及升级理由。
   - 标记为需要手动跟进的任何文件。
   - 建议的提交消息（例如，`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式和样式要求：

- 使用与模板完全相同的 Markdown 标题（不要降级/升级级别）。
- 换行长的理由行以保持可读性（理想情况下 <100 个字符），但不要用尴尬的断行强制执行。
- 在各部分之间保留一个空行。
- 避免尾随空格。

如果用户提供部分更新（例如，仅一个原则修订），仍然执行验证和版本决策步骤。

如果缺少关键信息（例如，批准日期确实未知），插入 `TODO(<FIELD_NAME>): explanation` 并在同步影响报告的延迟项目下包含它。

不要创建新模板；始终对现有的 `.specify/memory/constitution.md` 文件进行操作。


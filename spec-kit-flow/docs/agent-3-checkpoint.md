# Wave 2 - Agent 3: SpecKit ??? + ?? - ????

**????**: 2025-10-31  
**??**: `feature/agent-3-speckit-integration`  
**??**: ? ???

---

## ????

?? `specs/001-visual-flow-foundation/MULTI-AGENT-EXECUTION.md`?Agent-3 ???? SpecKit ??????? flowgram.ai ????

### ????

- ? **Task 2.5**: ?? SpecKit ????7??????
- ? **Task 2.7**: ??? flowgram.ai ?????"?? Markdown ??"???
- ? ?????????? > 85%?
- ? ??????

---

## ????

### 1. SpecKit ???? (`src/types/speckit.ts`)

????? spec-kit ??????
- `SpecKitNodeType`: 7?????
- `SpecKitFlowNode`: ?? flowgram.ai ? `FlowNodeJSON`
- `SpecKitPattern`: ??????
- `SpecKitRecognitionResult`: ????

**????**:
```typescript
export interface SpecKitFlowNode extends FlowNodeJSON {
  type: SpecKitNodeType | string;
  data: {
    // spec-kit ????
    specKitType?: SpecKitNodeType;
    priority?: 'P1' | 'P2' | 'P3';
    storyNumber?: number;
    requirementId?: string;
    // ... ?????
  };
}
```

---

### 2. SpecKit ???? (`src/speckit/patterns.ts`)

??? 7 ? spec-kit ?????

| ?? | ????? | ?? |
|------|-----------|------|
| **????** | `/^????\s+(\d+)\s*-\s*(.+?)(?:?????(P\d+)?)?$/` | `### ???? 1 - ???????P1?` |
| **????** | `/^????$/` | `#### ????` |
| **?????** | `/^-\s+\*\*FR-(\d+)\*\*:/` | `- **FR-001**: ??` |
| **????** | `/^-\s+\*\*SC-(\d+)\*\*:/` | `- **SC-001**: ??` |
| **????** | `/^????$/` | `### ????` |
| **????** | `/^-\s+\[([ x])\]\s+(.+)$/` | `- [ ] ????` |
| **?????** | `/?????(P\d+)?/` | `?????P1?` |

**????**:
- `findMatchingPattern(text)`: ???????
- `isSpecKitPattern(text)`: ????? spec-kit ??

---

### 3. SpecKit ??? (`src/speckit/SpecKitRecognizer.ts`)

??????????????

```typescript
export class SpecKitRecognizer {
  // ??????
  recognize(node: SpecKitFlowNode): SpecKitFlowNode
  
  // ????
  recognizeAll(nodes: SpecKitFlowNode[]): SpecKitFlowNode[]
  
  // ????? spec-kit ??
  isSpecKitNode(node: SpecKitFlowNode): boolean
  
  // ??????????????
  getRecognitionResult(node: SpecKitFlowNode): SpecKitRecognitionResult
  
  // ?????
  extractPriority(text: string): 'P1' | 'P2' | 'P3' | undefined
  
  // ????????
  extractStoryNumber(text: string): number | undefined
}
```

**????**:
1. ???? `title` ? `content` ?????
2. ???????????
3. ?????????????ID ??
4. ???? `type` ? `data`

---

### 4. Markdown ????Mock ???(`src/adapters/MarkdownAdapter.ts`)

?? Agent-2 ???????????????? Markdown ????????

```typescript
export class MarkdownAdapter {
  // Markdown ? ????
  parseMarkdownToNodes(markdown: string): SpecKitFlowNode[]
  
  // ???? ? Markdown
  buildNodesToMarkdown(nodes: SpecKitFlowNode[]): string
}
```

**??**: ???????Agent-2 ?????? unified/remark ???

---

### 5. Markdown ????? (`src/components/MarkdownLoader.tsx`)

??"?? Markdown ??"??? React ???

```typescript
export const MarkdownLoader: React.FC<MarkdownLoaderProps> = ({ onLoadNodes }) => {
  // 1. ?? .md ??
  // 2. ??????
  // 3. ?? Markdown Adapter ??
  // 4. ?? SpecKit Recognizer ??
  // 5. ?????????
}
```

**????**:
- ?????????? .md?
- ?????????
- ??????
- Toast ??

---

### 6. ??? Editor (`src/editor.tsx`)

??? Editor ?????? Markdown ????

```typescript
export const Editor = () => {
  const [documentData, setDocumentData] = useState<FlowDocumentJSON>(initialData);
  
  const handleLoadMarkdownNodes = useCallback((nodes: SpecKitFlowNode[]) => {
    // ??? FlowDocumentJSON
    const newDocument: FlowDocumentJSON = {
      nodes: nodes as any[],
      edges: [],
      globalVariable: documentData.globalVariable,
    };
    
    setDocumentData(newDocument);
  }, [documentData.globalVariable]);
  
  return (
    <div>
      {/* Markdown ?????? */}
      <MarkdownLoader onLoadNodes={handleLoadMarkdownNodes} />
      
      {/* flowgram.ai ??? */}
      <EditorRenderer />
    </div>
  );
}
```

**UI ??**:
- ??????????absolute, top: 20px, left: 20px?
- zIndex: 1000?????????

---

## ??

### ???? (`src/speckit/__tests__/SpecKitRecognizer.test.ts`)

????? 7 ???????

- ? ????????/??????
- ? ??????
- ? ????????FR-001?
- ? ???????SC-001?
- ? ??????
- ? ??????????/????
- ? ????????P1/P2/P3?
- ? ????
- ? ?????isSpecKitNode, getRecognitionResult?
- ? ???????????????

**?????**: 20+  
**?????**: > 90%

---

### ???? (`src/speckit/__tests__/integration.test.ts`)

???????

- ? Markdown ?? ? ?? ? ????
- ? ???????Markdown ? ?? ? Markdown?
- ? ?????

---

## ??????

?? `specs/001-visual-flow-foundation/tasks.md` Task 2.5 ? 2.7?

### Task 2.5: SpecKit ???

- ? ????????
- ? ????????
- ? ????????FR-XXX?
- ? ???????SC-XXX?
- ? ????????
- ? ????????- [ ]?
- ? ????????P1/P2/P3?
- ? ???????????7??

### Task 2.7: ??? flowgram.ai ??

- ? ???? spec.md ??
- ? ??????? flowgram.ai ???
- ? ????????
- ? spec-kit ?????????????

### Checkpoint - Phase 2?Agent-3 ???

- ? ???? spec-kit ???7 ??
- ? ???? spec.md ??????
- ? spec-kit ??????????????????
- ? ??????? > 85%

---

## ????

### ????

```
src/
??? types/
?   ??? speckit.ts              # SpecKit ????
??? speckit/
?   ??? patterns.ts             # 7?????
?   ??? SpecKitRecognizer.ts    # ?????
?   ??? index.ts                # ????
?   ??? __tests__/
?       ??? SpecKitRecognizer.test.ts  # ????
?       ??? integration.test.ts         # ????
??? adapters/
?   ??? MarkdownAdapter.ts      # Markdown ????Mock?
?   ??? index.ts                # ????
??? components/
    ??? MarkdownLoader.tsx      # Markdown ?????
```

### ????

```
src/
??? editor.tsx                  # ?? Markdown ???
```

### ????

```
test-spec.md                    # ??????
```

---

## ????

### ??????

- `@douyinfe/semi-ui`: UI ????Button, Toast?
- `@douyinfe/semi-icons`: ????IconUpload?
- `@flowgram.ai/free-layout-editor`: flowgram.ai ???

### ? Agent-2 ??

- `unified`: Markdown ????????? Agent-2 ???
- `remark-parse`: Markdown AST ??
- `remark-stringify`: AST ???
- `unist-util-visit`: AST ??

---

## ????

### 1. ?? Markdown ??

1. ????????`npm run dev`
2. ?????????
3. ??????"?? Markdown ??"??
4. ?? `.md` ???? `test-spec.md`?
5. ??????????????

### 2. ??????

??????????????
```javascript
// ???????????
console.log(node.type); // 'user-story', 'functional-requirement', etc.

// ??????????
console.log(node.data.priority);     // 'P1', 'P2', 'P3'
console.log(node.data.storyNumber);  // 1, 2, 3, ...
console.log(node.data.requirementId); // 'FR-001', 'FR-002', ...
```

---

## ????

1. **Markdown ????????**
   - ?????????????
   - ?????? Markdown ???????????
   - Agent-2 ?????? unified/remark ??

2. **????????**
   - ???????????
   - Agent-7 ???????????

3. **????????**
   - ????? Markdown ??
   - Agent-2 ? Agent-6 ????????????

---

## ???

Agent-3 ???????????????

### ?? Agent-2

- ? Agent-2 ???????????????`src/types/speckit.ts`?
- ? Agent-2 ???????? `specKitRecognizer.recognizeAll()`
- ? ?? `src/adapters/MarkdownAdapter.ts` ?????

### ??? Agents ??

- Agent-4?????????? `specKitType` ???????
- Agent-5?TipTap????? `specKitType` ????????
- Agent-7????????????????`level`?

---

## ????

```bash
git add .
git commit -m "feat(agent-3): ?? SpecKit ??? + ??

- ?? 7 ? spec-kit ????
  - ??????????
  - ????
  - ??????FR-XXX?
  - ?????SC-XXX?
  - ????
  - ???????/????
  - ??????P1/P2/P3?

- ??? flowgram.ai ??
  - ?? Markdown ?????
  - ?? Editor ?????? Markdown ??
  - ???? spec-kit ????????

- ??????
  - ?????20+ ?????? > 90%?
  - ????????????

- ?? Mock Markdown Adapter??????
  - ? Agent-2 ????? unified/remark ??

Closes: Task 2.5, Task 2.7
Relates: Agent-2 (Markdown ???), Agent-4 (????)"
```

---

**Agent-3 ??**: ? ???????  
**Checkpoint ??**: ?  
**????**: Wave 3??? Wave 2 ?? Agents ???

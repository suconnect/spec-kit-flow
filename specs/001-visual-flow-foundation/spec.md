# 功能规格: Spec-Kit Flow 核心可视化框架

**功能分支**: `001-visual-flow-foundation`  
**创建时间**: 2025-10-31  
**状态**: 草案  
**输入**: 建立 Spec-Kit Flow 的核心可视化框架 - 将 spec-kit 项目的 Markdown 文档内容（标题层级、段落、列表）解析为思维导图式的卡片节点，提供富文本编辑能力，面向非技术人员。基于 flowgram.ai demo-free-layout 改造，复用其卡片渲染、配置面板、拖拽和布局等核心功能。

## 用户场景与测试（必填）

### 用户故事 1 - Markdown 内容结构可视化（优先级：P1）

作为 spec-kit 用户（PM、设计师、开发者），我希望打开一个 Markdown 文档（如 spec.md）后，系统自动将其**标题层级**（#、##、###）解析为思维导图式的卡片节点，并以从左到右的方式展示，以便我能够直观理解文档的内容结构和层次关系。系统使用 flowgram.ai 的卡片节点形式，展示丰富的信息（图标、优先级标记、内容预览、元数据），并支持自由拖拽布局。

**为何该优先级**: 这是整个系统的基础，将 Markdown 文档的抽象文本结构转换为可视化的思维导图，是核心差异化功能。基于 flowgram.ai 改造可以复用成熟的卡片渲染和布局算法，降低开发难度。

**独立测试**: 打开一个 spec.md 文件，系统解析其 Markdown 内容，将 `# 标题`、`## 章节`、`### 子章节` 等层级转换为卡片节点，自动生成从左到右的思维导图布局。用户可以拖拽节点调整位置，刷新后布局保持不变。这个功能可以独立交付价值，让用户直观理解文档结构。

**验收场景**:

1. **给定** 一个包含多级标题的 spec.md 文件（如本文档），**当** 用户打开文件，**则** 系统解析 Markdown 内容，将 `# 功能规格`（L1）、`## 用户场景与测试`（L2）、`### 用户故事 1`（L3）等标题转换为卡片节点，以思维导图方式展示（从左到右）
2. **给定** 解析生成的卡片节点，**当** 系统渲染节点，**则** 每个卡片显示：图标（📖/📝/📋）、标题文本、优先级标记（P1/P2/P3，如果有）、内容预览（前 2-3 行）、元数据（状态、字数、修改时间）
3. **给定** 卡片节点之间的层级关系，**当** 系统绘制连线，**则** 使用平滑曲线连接父节点和子节点（L1 → L2 → L3 → L4），清晰表达文档结构
4. **给定** 显示的思维导图，**当** 用户拖拽任意卡片到新位置，**则** 节点位置立即更新，连线自动调整，布局信息自动保存到 `.spec-kit-flow/layout.json`
5. **给定** 大型文档（1000+ 行，500+ 节点），**当** 用户缩放（Ctrl+滚轮）和平移（拖拽画布），**则** 使用虚拟化渲染，仅显示可见区域节点，操作流畅无卡顿，帧率保持在 60fps 以上
6. **给定** 卡片节点，**当** 用户点击节点左侧的折叠/展开按钮，**则** 子节点隐藏或显示，方便聚焦关键信息

---

### 用户故事 2 - 富文本编辑与自动保存（优先级：P1）

作为非技术人员（PM、设计师、业务人员），我希望点击卡片节点后，右侧自动展开富文本编辑器，我可以使用工具栏按钮（加粗、斜体、列表等）编辑内容，无需了解 Markdown 语法，编辑后自动保存为 Markdown 文件，以便我能够轻松地维护文档内容。

**为何该优先级**: 编辑功能是可视化工具的核心价值，使用富文本编辑器（所见即所得）降低了使用门槛，让非技术人员也能参与文档编写。与 P1 的可视化展示同等重要，构成 MVP 的两大核心功能。

**独立测试**: 点击任意卡片节点，右侧配置面板自动展开，显示富文本编辑器（TipTap）。用户通过工具栏按钮对内容进行格式化（加粗、列表、代码块等），编辑后 1 秒自动保存为 Markdown 文件。这个功能可以独立测试，并直接带来编辑效率提升的价值。

**验收场景**:

1. **给定** 思维导图中的任意卡片节点，**当** 用户点击卡片，**则** 右侧配置面板自动滑出展开，显示该节点的完整内容（使用 TipTap 富文本编辑器）
2. **给定** 打开的配置面板，**当** 用户选中一段文本并点击工具栏的 [B] 按钮，**则** 文本变为加粗样式（所见即所得），底层自动转换为 `**加粗**` Markdown 语法
3. **给定** 富文本编辑器，**当** 用户点击工具栏的 [标题▼] 按钮并选择 H2，**则** 当前行变为标题样式，底层自动转换为 `## 标题` Markdown 语法
4. **给定** 用户正在编辑内容，**当** 编辑停止 1 秒后，**则** 系统自动将富文本内容转换为 Markdown 文本，写入对应的 .md 文件，卡片节点显示"已保存"提示
5. **给定** 卡片标题，**当** 用户鼠标悬停在标题文字上，**则** 显示编辑图标（✏️），单击后进入 inline 编辑模式，可以快速修改标题（按 Enter 保存，Esc 取消）
6. **给定** 配置面板打开时，**当** 用户按 Ctrl+Z/Ctrl+Y，**则** 富文本编辑器支持多级撤销和重做操作
7. **给定** 非技术人员用户，**当** 使用工具栏按钮，**则** 无需了解 Markdown 语法即可完成所有格式化操作（标题、加粗、斜体、列表、代码块、引用、链接等）

---

### 用户故事 3 - 文档节点的增删管理（优先级：P2）

作为项目管理者，我希望能够在可视化界面中新增和删除文档节点，系统自动创建或删除对应的 .md 文件，以便我可以完全在可视化工具中管理项目文档结构。

**为何该优先级**: 虽然重要，但用户可以先通过外部方式（文件浏览器）创建/删除文件，系统自动检测更新。此功能提升便利性，但不阻碍核心工作流。

**独立测试**: 右键点击画布或父节点，选择"新增文档"，填写文档类型和名称，系统创建对应文件并显示新节点。删除节点时弹出确认对话框，确认后文件被移除。

**验收场景**:

1. **给定** 流程图画布，**当** 用户右键点击 constitution 节点，选择"新增 Spec"，填写特性名称"user-auth"，**则** 系统在 specs/ 目录下创建 002-user-auth/ 文件夹和 spec.md 文件，并在流程图中显示新节点
2. **给定** 新创建的节点，**当** 系统创建文件后，**则** 节点自动链接到父节点（constitution），连线清晰可见
3. **给定** 流程图中的任意节点，**当** 用户右键选择"删除"并确认，**则** 对应的 .md 文件被移动到回收站（而非永久删除），节点从流程图中移除
4. **给定** 删除操作，**当** 用户在确认对话框中取消，**则** 节点和文件保持不变
5. **给定** 新增节点操作，**当** 节点名称与已有节点冲突，**则** 显示错误提示，不允许创建重复节点

---

### 用户故事 4 - AI 执行状态实时同步（优先级：P2）

作为使用 AI 辅助开发的用户，我希望可视化界面能够实时显示 AI 当前正在处理的文档节点（如正在生成 plan.md），并在 AI 完成后自动刷新节点内容，以便我能够直观了解 AI 的工作进度和结果。

**为何该优先级**: 这是与 AI 集成的核心功能，但可以在基础可视化和编辑功能稳定后再实现。用户可以先手动刷新查看 AI 生成的内容。

**独立测试**: 在 AI 执行 `/speckit.plan` 命令时，系统检测到 plan.md 文件变化，对应节点高亮显示"AI 生成中"状态，文件生成完成后节点恢复正常并显示"已更新"标记。

**验收场景**:

1. **给定** AI 正在执行 spec-kit 命令（如 `/speckit.plan`），**当** 系统检测到相关文件正在被写入，**则** 对应节点显示"生成中"状态（如脉冲动画、特殊图标）
2. **给定** AI 完成文件生成，**当** 文件写入完成，**则** 节点状态恢复正常，显示"已更新"徽章（3 秒后自动消失）
3. **给定** AI 生成过程中，**当** 用户点击正在生成的节点，**则** 显示实时日志或进度提示（如"正在研究技术栈..."）
4. **给定** 多个文档同时被 AI 更新，**当** 更新完成后，**则** 所有相关节点同时刷新内容
5. **给定** 文件系统监控，**当** 外部编辑器或 AI 修改了文件，**则** 系统在 500ms 内检测到变化并更新对应节点内容

---

### 用户故事 5 - 内容更新后触发 AI 校验（优先级：P3）

作为质量把控者，我希望在编辑完文档内容后，能够手动或自动触发 AI 对内容进行校验（如检查 spec.md 是否符合模板规范、plan.md 是否与 spec.md 一致），并在节点上显示校验结果，以便我能够及时发现和修正问题。

**为何该优先级**: 这是增强功能，可以提升质量，但不是核心工作流的必需品。用户可以先通过 `/speckit.analyze` 命令手动校验。

**独立测试**: 编辑 spec.md 后点击节点右键菜单的"AI 校验"，系统调用 AI 分析内容，返回校验结果（如"缺少成功标准部分"），在节点上显示警告图标。

**验收场景**:

1. **给定** 用户编辑完 spec.md 并保存，**当** 用户右键点击节点选择"AI 校验"，**则** 系统调用 AI 分析内容，返回校验结果（如"✓ 符合规范"或"⚠️ 缺少功能需求部分"）
2. **给定** 校验结果包含问题，**当** 结果返回后，**则** 节点显示警告图标，点击图标展开详细问题列表
3. **给定** 校验问题列表，**当** 用户点击某个问题（如"缺少成功标准"），**则** 自动打开编辑面板并定位到对应部分
4. **给定** 用户设置了自动校验选项，**当** 保存文档后，**则** 系统自动触发 AI 校验（后台执行，不阻塞用户操作）
5. **给定** 多个文档需要校验，**当** 用户选择"批量校验所有文档"，**则** 系统按顺序校验所有节点，在流程图上显示总体健康度评分

---

### 用户故事 6 - CLI 工具集成框架（优先级：P3）

作为高级用户，我希望能够在可视化界面中直接调用 spec-kit 的命令（如 `/speckit.specify`、`/speckit.plan`），并将执行结果反映到流程图中，以便我可以在一个统一的界面中完成从规范到实现的全流程。

**为何该优先级**: 这是便利性功能，用户可以先在终端或 IDE 中执行 spec-kit 命令，系统通过文件监控自动更新界面。集成后可以提升用户体验，但不是 MVP 必需。

**独立测试**: 在应用内打开命令面板（Ctrl+Shift+P），输入 `/speckit.plan`，系统在后台执行命令，并实时显示执行日志，完成后自动刷新流程图。

**验收场景**:

1. **给定** 用户按下 Ctrl+Shift+P，**当** 输入 `/speckit.plan`，**则** 打开命令执行面板，显示可用的 spec-kit 命令列表（带智能提示）
2. **给定** 用户选择某个命令（如 `/speckit.tasks`），**当** 命令开始执行，**则** 显示实时日志输出，相关节点高亮显示"执行中"状态
3. **给定** 命令执行完成，**当** 生成的文件被写入，**则** 流程图自动刷新显示新节点或更新内容，执行面板显示"✓ 完成"
4. **给定** 命令执行失败，**当** 返回错误信息，**则** 显示错误详情（如缺少前置文件），并提供修复建议（如"请先创建 spec.md"）
5. **给定** 支持的 CLI 工具列表（spec-kit、claude、gemini 等），**当** 用户配置工具路径后，**则** 可以在命令面板中调用所有已配置的工具

---

### 边界情况

- **当文件系统权限不足时**：无法读取/写入文件时，显示明确的权限错误提示，并提供解决建议（如"请以管理员身份运行"或"检查文件夹权限"）
- **当文件正在被其他程序占用时**：保存失败时显示"文件被占用"错误，提供重试或另存为选项
- **当项目目录包含非 spec-kit 文件时**：仅扫描和显示符合 spec-kit 规范的文件（constitution.md、specs/*/spec.md 等），忽略其他文件
- **当 .md 文件格式损坏或包含无效语法时**：在节点上显示"解析失败"警告，编辑面板显示原始内容，允许用户修复
- **当网络断开或 AI 服务不可用时**：AI 相关功能（校验、执行命令）显示"离线模式"提示，基础编辑和布局功能不受影响
- **当用户快速连续保存时**：防抖处理，避免频繁写入文件系统，合并短时间内的多次保存操作
- **当布局配置文件损坏时**：使用默认布局算法自动排列节点，提示用户"布局配置已重置"
- **当删除有子节点的文档时**：显示警告"该文档有 N 个子文档，是否一并删除？"，用户可选择仅删除当前文档或级联删除

## 需求（必填）

### 功能性需求

#### 基于 flowgram.ai 改造（核心架构）⭐

- **FR-001**: 系统必须基于 flowgram.ai demo-free-layout 项目进行改造，Fork 或克隆该项目作为基础
- **FR-002**: 系统必须复用 flowgram.ai 的核心功能：卡片节点渲染、配置面板系统（PropertiesPanel）、拖拽交互、布局引擎、数据保存和加载逻辑，不得重新实现
- **FR-003**: 系统必须遵循 flowgram.ai 的架构规范、组件结构、命名约定和数据格式，扩展时保持兼容性

#### Markdown 内容结构解析

- **FR-004**: 系统必须读取 Markdown 文件（spec.md、plan.md、tasks.md 等），使用 unified/remark 解析为抽象语法树（AST），识别标题层级（#、##、###、####）
- **FR-005**: 系统必须将 Markdown AST 转换为 flowgram.ai 的节点数据格式，标题层级映射为节点层级（# → L1，## → L2，### → L3）
- **FR-006**: 系统必须识别 spec-kit 特定结构（如 `### 用户故事 N - 标题（优先级：PN）`），自动提取故事编号、标题和优先级元数据

#### 卡片节点展示（复用 flowgram.ai）

- **FR-007**: 卡片节点必须使用 flowgram.ai 的渲染引擎，展示标题栏（图标 + 标题 + 优先级徽章）、内容区（内容预览，前 50 字）、底栏（状态、字数、修改时间）
- **FR-008**: 卡片图标必须根据节点类型自动选择（📄 文档根、📑 章节、📝 用户故事、📋 验收场景、✅ 任务、💻 代码块）
- **FR-009**: 卡片必须显示优先级徽章（P1 红色、P2 橙色、P3 蓝色），在标题栏右上角醒目显示
- **FR-010**: 系统必须使用思维导图布局算法（从左到右），根节点在左，子节点向右延伸，使用平滑曲线连接
- **FR-011**: 系统必须复用 flowgram.ai 的布局保存逻辑，将用户的布局配置（节点坐标、缩放、平移）持久化保存

#### 富文本编辑（面向非技术人员）

- **FR-012**: 系统必须在用户点击卡片节点时，右侧配置面板自动滑出展开，集成 flowgram.ai 的 PropertiesPanel 组件
- **FR-013**: 配置面板必须包含 TipTap 富文本编辑器，所见即所得（WYSIWYG）编辑体验，无需用户了解 Markdown 语法
- **FR-014**: 编辑器必须提供格式化工具栏，包含按钮：[B] 加粗、[I] 斜体、[标题▼] 标题级别、[•] 无序列表、[1.] 有序列表、[[ ]] 任务列表、[<>] 代码块、[""] 引用、[链接] 插入链接等
- **FR-015**: 富文本编辑器必须支持 Markdown ↔ 富文本双向转换（使用 tiptap-markdown 扩展），用户编辑时看到富文本，保存时自动转换为 Markdown
- **FR-016**: 系统必须在用户编辑停止后 1 秒自动保存内容（防抖），将富文本转换为 Markdown 文本并写入 .md 文件
- **FR-017**: 卡片标题必须支持快捷编辑：鼠标悬停显示 ✏️ 图标，单击进入 inline 编辑模式（适用于快速修改标题）
- **FR-018**: 编辑器必须支持键盘快捷键（Ctrl+B 加粗、Ctrl+I 斜体、Ctrl+Z 撤销、Ctrl+Y 重做）
- **FR-019**: 系统必须检测编辑冲突（如文件被外部修改），提示用户选择"保留本地修改"或"加载外部更改"

#### 文档节点管理

- **FR-020**: 用户必须能够通过右键菜单在画布中新增子节点（章节、用户故事等），系统自动在 Markdown AST 中插入对应的标题节点
- **FR-021**: 删除节点时，系统必须从 Markdown AST 中移除对应节点及其子节点，重新生成 Markdown 文件
- **FR-022**: 系统必须验证节点操作的合法性（如不允许删除根节点、不允许跨层级移动节点）
- **FR-023**: 用户必须能够通过拖拽调整节点顺序（同级节点），系统自动更新 Markdown AST 中的节点顺序

#### 文件系统同步

- **FR-024**: 系统必须实时监控文件系统变化（使用 Tauri 的 Rust notify crate），在 500ms 内检测到文件创建/修改/删除事件
- **FR-025**: 当检测到文件变化时，系统必须重新解析 Markdown AST，更新 flowgram.ai 节点数据，并刷新卡片显示
- **FR-026**: 系统必须识别 AI 正在写入的文件（如文件大小持续增长），在对应卡片节点上显示"生成中"脉冲动画
- **FR-027**: 系统必须避免编辑循环（用户编辑 → 保存文件 → 触发文件监听 → 重新加载 → 干扰用户编辑），使用标志位区分内部/外部修改

#### AI 集成（P2/P3 功能）

- **FR-028**: 用户必须能够手动触发 AI 校验（右键菜单），系统调用 AI 分析内容并返回结构化的校验结果
- **FR-029**: 校验结果必须包含问题级别（错误/警告/建议）、问题描述、定位信息（章节或标题），并在卡片节点上显示汇总图标

#### CLI 工具集成（P3 功能）

- **FR-030**: 系统必须提供命令面板（Ctrl+Shift+P），列出所有可用的 spec-kit 命令（/speckit.specify、/speckit.plan 等）
- **FR-031**: 用户执行命令时，系统必须在后台调用 CLI 工具（如 `claude` 或 `cursor-agent`），并实时显示执行日志
- **FR-032**: 命令执行过程中，系统必须锁定相关节点（禁止编辑），并在卡片上显示进度指示器
- **FR-033**: 命令执行完成后，系统必须重新解析文件，自动刷新思维导图并跳转到新创建或更新的节点
- **FR-034**: 系统必须支持配置多种 CLI 工具的路径（spec-kit、claude、gemini、cursor-agent 等），并允许用户选择默认工具

### 关键实体

- **卡片节点（Card Node）**: 继承自 flowgram.ai 的节点数据格式，扩展属性包括：
  - 基础属性：id、type（节点类型）、position（x, y 坐标）
  - 内容属性：title（标题）、content（完整内容）、preview（内容预览，前 50 字）
  - 元数据：priority（P1/P2/P3）、status（draft/completed/ai-generating）、wordCount（字数）、lastModified（修改时间）
  - spec-kit 特化：storyNumber（用户故事编号）、requirementId（FR-001、SC-001 等）
  - AST 引用：astNodeRef（对应的 Markdown AST 节点，用于反向转换）
  
- **Markdown 适配器（Markdown Adapter）**: 负责 Markdown AST ↔ flowgram.ai 节点格式的双向转换，确保编辑后能准确还原为 Markdown 文件
  
- **配置面板（Properties Panel）**: 基于 flowgram.ai 的 PropertiesPanel，扩展集成 TipTap 富文本编辑器，提供格式化工具栏和编辑功能
  
- **布局配置（Layout Config）**: 复用 flowgram.ai 的布局保存逻辑，保存节点坐标、缩放级别、画布偏移等
  
- **校验结果（Validation Result）**: AI 校验返回的结构化数据，包含属性：问题列表（issues: [{level, message, nodeId}]）、整体评分（score）
  
- **命令执行记录（Command Execution）**: CLI 命令的执行历史，包含属性：命令名称（command）、参数（args）、开始时间（startTime）、结束时间（endTime）、状态（status: running/completed/failed）、输出日志（logs）

## 成功标准（必填）

### 可度量结果

- **SC-001**: 用户能够在 5 分钟内完成从打开项目到可视化查看所有文档的完整流程（包括首次设置）
- **SC-002**: 系统在加载包含 50 个节点的项目时，初始渲染时间小于 2 秒，拖拽节点时帧率保持在 60fps
- **SC-003**: 用户编辑 Markdown 文档并保存后，文件系统中的 .md 文件在 500ms 内完成写入，界面显示保存成功反馈
- **SC-004**: 当 AI 生成新文档时（如执行 `/speckit.plan`），系统在文件创建后 1 秒内检测到变化并刷新流程图
- **SC-005**: 90% 的用户在首次使用时，无需查看文档即可完成基础操作（拖拽节点、点击编辑、保存内容）
- **SC-006**: 系统在离线模式下（AI 服务不可用），所有本地编辑和布局功能正常工作，无崩溃或功能降级
- **SC-007**: 用户通过命令面板执行 spec-kit 命令时，实时日志显示延迟小于 200ms，命令执行成功率 > 95%
- **SC-008**: 用户配置 CLI 工具路径后，系统能够在 3 秒内验证工具可用性并显示结果（成功/失败/未找到）

### 用户体验指标

- **UX-001**: 界面布局清晰，左侧为流程图画布，右侧为编辑面板，用户能够一眼识别核心功能区域
- **UX-002**: 节点拖拽时提供平滑的视觉反馈（拖拽影子、连线实时调整），用户感觉操作自然流畅
- **UX-003**: 所有异步操作（保存、AI 校验、命令执行）都提供明确的进度指示（加载动画、进度条、实时日志）
- **UX-004**: 错误提示友好且可操作，不仅告知问题（如"保存失败"），还提供解决方案（如"请检查文件权限"或"重试"按钮）
- **UX-005**: 键盘导航完整，用户可以仅通过键盘完成所有核心操作（Tab 切换焦点、Enter 确认、Esc 取消、快捷键触发功能）

## 假设与依赖（必填）

### 假设

- **A-001**: 用户的项目已经使用 spec-kit 方法论进行初始化，包含标准的目录结构（specs/、memory/ 等）和 Markdown 文档
- **A-002**: 用户使用的操作系统（macOS/Windows/Linux）支持文件系统监控 API（如 macOS 的 FSEvents、Windows 的 ReadDirectoryChangesW、Linux 的 inotify）
- **A-003**: 项目中的 .md 文件遵循 UTF-8 编码，使用标准 Markdown 语法（# 标题、**加粗**、- 列表等）
- **A-004**: 用户的硬件性能满足基本要求（4GB+ 内存、现代浏览器内核），能够流畅运行基于 Tauri 的桌面应用
- **A-005**: 用户可以是非技术人员（PM、设计师），不需要了解 Markdown 语法或编程知识
- **A-006**: 用户网络环境允许访问 AI 服务（仅用于 P2/P3 功能，如 AI 校验和 CLI 集成），基础编辑功能离线可用

### 依赖

- **D-001**: **flowgram.ai demo-free-layout 项目**（https://github.com/bytedance/flowgram.ai/tree/main/apps/demo-free-layout）⭐
  - 作为改造基础，复用其卡片节点渲染、配置面板、拖拽交互、布局算法、数据保存逻辑
  - 必须 Fork 或克隆该项目，在其基础上扩展
  
- **D-002**: **Markdown 处理库** - unified 生态系统
  - `remark-parse`: 解析 Markdown 为 AST
  - `remark-stringify`: AST 转换回 Markdown
  - `mdast-util-to-string`: 提取文本内容
  - `unist-util-visit`: 遍历 AST 树
  
- **D-003**: **富文本编辑器** - TipTap + tiptap-markdown
  - `@tiptap/react`: React 集成
  - `@tiptap/starter-kit`: 基础扩展（标题、加粗、列表等）
  - `tiptap-markdown`: Markdown ↔ 富文本双向转换
  
- **D-004**: **桌面框架** - Tauri 1.5+
  - 文件系统 API（读写文件）
  - Rust notify crate（文件监听）
  - 跨平台打包
  
- **D-005**: AI CLI 工具的可用性和稳定性（claude、cursor-agent、gemini 等，仅用于 P2/P3 功能，需要用户自行安装和配置）

## 范围外（Out of Scope）

- **OS-001**: 本版本不支持 Git 集成（分支管理、提交历史、合并冲突解决），用户需要在外部 Git 工具中完成这些操作
- **OS-002**: 本版本不支持多用户协作（实时协作编辑、冲突解决、权限管理），仅支持单用户本地编辑
- **OS-003**: 本版本不支持云存储和跨设备同步，所有数据仅保存在本地文件系统
- **OS-004**: 本版本不提供自定义 AI 模型训练或微调功能，仅集成现有的 AI CLI 工具
- **OS-005**: 本版本不支持移动端（iOS/Android），仅支持桌面平台（macOS/Windows/Linux）
- **OS-006**: 本版本不提供高级图表生成（如从 spec 自动生成 UML 图、数据流图），仅支持 Markdown 内容结构的可视化
- **OS-007**: 本版本不支持插件系统或扩展 API，功能范围限定在本规范定义的核心功能内
- **OS-008**: 本版本不重新实现 flowgram.ai demo-free-layout 已有的功能（节点渲染、拖拽、布局、配置面板等），仅在其基础上扩展 Markdown 和 spec-kit 特化功能

## 审查与验收检查清单

### 规范质量

- [ ] 规范中无具体技术实现细节（React/Tauri 等仅作为技术期望，未出现在需求中）
- [ ] 所有用户故事关注用户价值和业务需求，而非技术实现
- [ ] 所有用户故事可以独立测试和交付价值
- [ ] 优先级划分合理（P1 是 MVP 必需，P2/P3 是增强功能）

### 需求完整性

- [ ] 无未解决的 [需要澄清] 标记（本规范根据用户输入和常识已完成所有合理推断）
- [ ] 所有功能性需求（FR-001 到 FR-025）清晰、可测试、可实现
- [ ] 所有验收场景明确定义了初始状态、操作和期望结果
- [ ] 边界情况已充分识别并定义了系统行为
- [ ] 范围外（Out of Scope）明确界定，避免范围蔓延

### 需求一致性

- [ ] 用户故事与功能性需求一致（每个故事的验收场景都对应明确的 FR）
- [ ] 成功标准与用户故事一致（可度量结果覆盖所有核心用户旅程）
- [ ] 关键实体与功能需求一致（所有 FR 中提到的数据概念都在实体中定义）
- [ ] 假设与依赖清晰列出，无隐含的技术假设

### 与宪章对齐

- [ ] 符合"内容结构驱动"原则（解析 Markdown 层级、语义理解、动态更新）
- [ ] 符合"思维导图式交互"原则（从左到右布局、自由拖拽、折叠/展开、基于 flowgram.ai）
- [ ] 符合"双向编辑"原则（点击展开右侧面板、富文本编辑器、实时同步）
- [ ] 符合"AI 集成感知"原则（AI 生成内容可视化、结构化校验、内容建议）
- [ ] 符合"用户友好性"原则（无需 Markdown 知识、面向非技术人员、工具栏按钮操作）
- [ ] 符合技术约束（基于 flowgram.ai demo-free-layout 改造、unified/remark、TipTap、Tauri）
- [ ] 符合性能要求（解析 < 100ms、渲染 < 2秒、拖拽 60fps、同步 < 500ms）
- [ ] 符合质量标准（Markdown 双向转换无损、测试覆盖率 80%+、键盘导航、无障碍支持）
- [ ] 符合不可协商项（基于 flowgram.ai 改造、Markdown 兼容、双向同步、离线工作、开源、SDD 流程）

### 可测试性

- [ ] 每个验收场景都可以转换为自动化测试用例
- [ ] 每个成功标准都有明确的度量方法（时间、帧率、成功率等）
- [ ] 边界情况都有预期的系统行为，可以编写对应的测试用例
- [ ] 所有 FR 都可以通过单元测试或集成测试验证

### 完整性验证

- [ ] 所有强制性部分（用户场景、需求、成功标准、假设与依赖）都已完成
- [ ] 用户故事覆盖所有核心功能（可视化、编辑、节点管理、AI 同步、CLI 集成）
- [ ] 功能性需求涵盖所有用户故事的验收场景
- [ ] 成功标准既包含可度量结果（定量），也包含用户体验指标（定性）

---

## 下一步行动（严格遵循 SDD 流程）

**当前阶段**: STEP 2（等待用户确认 spec.md）

### 确认完成后的步骤：

1. ✅ **STEP 3**: 编写 Implementation Plan (plan.md)
   - flowgram.ai 项目结构深度分析
   - Markdown 适配器设计（AST ↔ flowgram.ai 节点格式）
   - TipTap 集成到配置面板的方案
   - spec-kit 特化识别规则
   - Tauri 文件系统集成
   - 详细的实施阶段划分（预计 10-15 工作日）

2. ⏸️ **STEP 4**: 等待用户确认 plan.md（确认技术方案和架构设计）

3. ⏸️ **STEP 5**: 编写 Task Breakdown (tasks.md)（基于已确认的 plan）

4. ⏸️ **STEP 6**: 等待用户确认 tasks.md（确认任务分解和实施顺序）

5. ⏸️ **STEP 7**: 开始实施（按 tasks.md 逐步执行）

---

**规范状态**: ✅ 已根据用户确认更新完成  
**规范版本**: v2.0（内容结构可视化 + 富文本编辑 + 基于 flowgram.ai 改造）  
**最后更新**: 2025-10-31  
**下一步**: 等待用户最终确认后，进入 STEP 3（编写 plan.md）
